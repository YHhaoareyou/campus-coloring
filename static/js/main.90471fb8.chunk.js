(this["webpackJsonpcampus-coloring"]=this["webpackJsonpcampus-coloring"]||[]).push([[0],{113:function(e,t,n){},114:function(e,t,n){},127:function(e,t,n){"use strict";n.r(t);var a=n(3),i=n(22),r=n(23),s=n(26),o=n(25),c=n(1),l=n.n(c),u=n(38),d=n.n(u),h=(n(113),n(34)),p=(n(114),n(115),n(140)),m=n(35),g=n(61),j=n(142),b=n(56);function f(){var e=Object(h.a)(["\n  position: absolute;\n  left: 0;\n  top: 45%;\n  width: 100%;\n  height: 5%;\n"]);return f=function(){return e},e}var O=Object(m.a)(j.a)(f()),v=function(e){var t=e.switchToPrev,n=e.switchToNext;return Object(a.jsxs)(O,{children:[Object(a.jsx)(j.a.Column,{width:1,children:Object(a.jsx)(p.a,{onClick:t,children:Object(a.jsx)(b.a,{name:"angle left"})})}),Object(a.jsx)(j.a.Column,{width:14}),Object(a.jsx)(j.a.Column,{width:1,children:Object(a.jsx)(p.a,{onClick:n,children:Object(a.jsx)(b.a,{name:"angle right"})})})]})},x=n(143),I=n(55),y=n(99),w=function(e){Object(s.a)(n,e);var t=Object(o.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={likes:e.props.image.likes||0,isClicked:!1},e.like=function(){var t=e.props,n=t.location,a=t.image;t.db.ref("locations/"+n).child(a.id.toString()).child("likes").set(a.likes?a.likes+1:1),e.setState((function(e){return Object(I.a)(Object(I.a)({},e),{},{likes:e.likes+1,isClicked:!0})}))},e}return Object(r.a)(n,[{key:"componentDidUpdate",value:function(e){e.image&&this.props.image&&e.image!==this.props.image&&this.setState({likes:this.props.image.likes||0,isClicked:!1})}},{key:"render",value:function(){var e=this.state,t=e.likes,n=e.isClicked;return Object(a.jsxs)(p.a,{color:"red",style:{marginTop:"1.5rem",padding:"0.8rem 0.3rem 0.6rem 1rem"},onClick:this.like,disabled:n,children:[Object(a.jsx)(b.a,{name:"heart"}),Object(a.jsx)(y.a,{style:{top:"1rem"},floating:!0,children:t})]})}}]),n}(l.a.Component);function k(){var e=Object(h.a)(["\n  position: absolute;\n  left: 0;\n  bottom: 0;\n  width: 100%;\n  height: 15%;\n"]);return k=function(){return e},e}var C=Object(m.a)(j.a)(k()),S=function(e){var t=e.location,n=e.image,i=e.openCanvas,r=e.db;return Object(a.jsxs)(C,{children:[Object(a.jsx)(j.a.Column,{width:8,style:{padding:"1rem"},children:Object(a.jsxs)(x.a,{children:[Object(a.jsx)("h4",{children:n.name}),Object(a.jsx)("p",{children:n.description})]})}),Object(a.jsx)(j.a.Column,{width:2,style:{padding:"1rem 0px"},children:Object(a.jsx)(w,{location:t,image:n,db:r})}),Object(a.jsxs)(j.a.Column,{width:6,style:{padding:"1rem"},children:[Object(a.jsx)(p.a,{color:"green",onClick:i,style:{padding:"1rem 0.2rem",width:"100%"},children:"Create new"}),Object(a.jsx)(p.a,{color:"orange",onClick:i,disabled:!0,style:{padding:"1rem 0.2rem",width:"100%"},children:"Paint on this"})]})]})},L=n(97),A=void 0,D=function(e){var t=e.db,n=e.storage,i=e.location;return Object(a.jsx)(L.ReactPainter,{width:window.innerWidth,height:.8*window.innerHeight,onSave:function(e){var a,r,s,o;do{s=prompt("What's your name? Any nickname is fine!")}while(!s);do{a=prompt("Please name your painting:")}while(!a);r=prompt("Please write something about this painting:"),o=window.confirm("Do you allow other users create paintings basing on this one?"),(new Image).src=e;var c=Date.now();n.ref().child("images/"+a).put(e).then((function(e){return e.ref.getDownloadURL()})).then((function(e){t.ref("image_urls").child(c).set(e).then((function(e){t.ref("locations").child(i+"/"+c).set({name:a,description:r,timestamp:c,user:s,is_public:o}).then((function(e){alert("Uploaded! Refresh the page to see your materpiece!")})).catch((function(e){alert(e)}))}))}))},render:function(e){var t=e.canvas,n=e.triggerSave,r=e.setColor,s=e.setLineWidth;return Object(a.jsxs)("div",{style:{zIndex:"1000"},children:[Object(a.jsx)("h2",{style:{margin:"0px"},children:i||"none"}),Object(a.jsx)("div",{style:{backgroundColor:"rgba(0, 0, 0, 0)",border:"5px solid #666"},children:t}),Object(a.jsxs)("div",{style:{padding:"1rem",background:"#ccc"},children:[Object(a.jsxs)("div",{children:["Color"," ",Object(a.jsx)("input",{type:"color",onChange:function(e){return r(e.target.value)},style:{width:"30%"}})," ","Width"," ",Object(a.jsx)("input",{type:"number",placeholder:"5",min:"1",max:"20",onChange:function(e){return s(e.target.value)},style:{width:"30%"}})]}),Object(a.jsxs)("div",{style:{paddingTop:"1rem"},children:[Object(a.jsx)(p.a,{color:"red",icon:"close",onClick:function(){return A.setState({isCanvasOpen:!1})}}),Object(a.jsx)(p.a,{color:"orange",onClick:A.resetCanvas,children:"Reset"}),Object(a.jsx)(p.a,{color:"green",onClick:n,children:"Save!!"})]})]})]})}})};function T(){var e=Object(h.a)(["\n  width: 100%;\n  text-align: center;\n"]);return T=function(){return e},e}function R(){var e=Object(h.a)(["\n  position: relative;\n  width: 100%;\n  height: 100%;\n"]);return R=function(){return e},e}function P(){var e=Object(h.a)(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n"]);return P=function(){return e},e}var U=Object(m.a)("div")(P()),M=Object(m.a)("div")(R()),N=Object(m.a)("div")(T()),E=function(e){Object(s.a)(n,e);var t=Object(o.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={isCanvasOpen:!1,currentImg:e.props.imagesInfo&&e.props.imagesInfo.length&&e.props.imagesInfo[0]},e.signIn=function(){try{e.props.auth.signInWithRedirect(new g.a.auth.GoogleAuthProvider)}catch(t){alert(t)}},e.signOut=function(){try{e.props.auth.signOut()}catch(t){alert(t)}},e.switchToPrevImage=function(){var t=e.props,n=t.imagesInfo,a=t.setDisplayImageIndex,i=e.state.currentImg,r=0===n.indexOf(i)?n.length-1:n.indexOf(i)-1;e.setState({currentImg:n[r]}),a(r)},e.switchToNextImage=function(){var t=e.props,n=t.imagesInfo,a=t.setDisplayImageIndex,i=e.state.currentImg,r=n.indexOf(i)+1===n.length?0:n.indexOf(i)+1;e.setState({currentImg:n[r]}),a(r)},e.resetCanvas=function(){e.setState({isCanvasOpen:!1},(function(){return e.setState({isCanvasOpen:!0})}))},e}return Object(r.a)(n,[{key:"componentDidUpdate",value:function(e){this.props.imagesInfo&&e.imagesInfo!==this.props.imagesInfo&&(this.props.imagesInfo.length>0?this.setState({currentImg:this.props.imagesInfo[0]}):this.setState({currentImg:null}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.user,i=t.currentLocation,r=t.db,s=t.storage,o=this.state,c=o.isCanvasOpen,l=o.currentImg;return Object(a.jsx)(U,{children:Object(a.jsxs)(M,{children:[Object(a.jsxs)(N,{children:[n&&"loading"!==n&&Object(a.jsxs)("span",{children:[n.displayName,", welcome! "]}),n?"loading"===n?Object(a.jsx)("h2",{children:"Loading..."}):Object(a.jsx)(p.a,{onClick:this.signOut,children:"Sign out"}):Object(a.jsx)(p.a,{onClick:this.signIn,children:"Sign in"})]}),c&&Object(a.jsx)(D,{location:i,db:r,storage:s}),l&&!c&&Object(a.jsx)(v,{switchToPrev:this.switchToPrevImage,switchToNext:this.switchToNextImage}),l&&!c&&Object(a.jsx)(S,{location:i,image:l,openCanvas:function(){return e.setState({isCanvasOpen:!0})},db:r})]})})}}]),n}(l.a.Component),W=n(83),B=n.n(W),z=n(98),_=function(e){Object(s.a)(n,e);var t=Object(o.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).entityRef=l.a.createRef(),a}return Object(r.a)(n,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return Object(a.jsx)("a-nft",{markerhandler:!0,type:"nft",url:"https://yhhaoareyou.github.io/campus-coloring/descriptors/"+this.props.location,smooth:"true",smoothCount:"10",smoothTolerance:".01",smoothThreshold:"5",id:"a-nft","data-location":this.props.location,children:this.props.images.map((function(t,n){return Object(a.jsx)("a-image",{src:"#"+t.id,width:n===e.props.displayImageIndex?500:0,height:n===e.props.displayImageIndex?500:0,position:"150 0 0",rotation:"-90 0 0"},t.id)}))})}}]),n}(l.a.Component),F=n.p+"static/media/hiro-marker.81a8bff1.png",G=(n(123),n(128),function(e){Object(s.a)(n,e);var t=Object(o.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={locationNames:[],currentLocation:"",currentImages:[],imageUrlsById:{}},e}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=Object(z.a)(B.a.mark((function e(){var t,n,a,i,r,s,o=this;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.db,e.next=3,t.ref().once("value");case 3:n=e.sent,a=n.val().image_urls,i=n.val().locations,this.setState({imageUrlsById:a,locationNames:Object.keys(i)}),r=function(e){o.setState({currentImages:e}),o.props.setImagesInfo(e)},s=function(e){o.setState({currentLocation:e}),o.props.setLocation(e)},window.AFRAME.registerComponent("markerhandler",{init:function(){this.el.sceneEl.addEventListener("markerFound",(function(e){var n=e.target.dataset.location;s(n),t.ref("locations").child(n).once("value",(function(e){var t=[],n=e.val();for(var a in n)t.push(Object(I.a)(Object(I.a)({},n[a]),{},{id:a}));r(t)}))})),this.el.sceneEl.addEventListener("markerLost",(function(e){return r([])}))}});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){delete window.AFRAME.components.markerhandler}},{key:"render",value:function(){var e=this,t=this.state,n=t.locationNames,i=t.currentLocation,r=t.currentImages,s=t.imageUrlsById,o=Object.keys(s).length>0,c=n.length>0;return Object(a.jsxs)("a-scene",{id:"a-scene","vr-mode-ui":"enabled: false;",renderer:"logarithmicDepthBuffer: true;",embedded:!0,arjs:"trackingMethod: best; sourceType: webcam;debugUIEnabled: false;",children:[o&&Object(a.jsxs)("a-assets",{children:[Object(a.jsx)("img",{id:"hiroMarker",src:F,alt:"hiroMarker"}),Object.keys(s).map((function(e){return Object(a.jsx)("img",{id:e,src:s[e],alt:e,crossOrigin:"anonymous"},e)}))]}),o&&c&&n.map((function(t){return Object(a.jsx)(_,{location:t,images:i===t&&r.length>0?r:[],displayImageIndex:e.props.displayImageIndex},t)})),Object(a.jsx)("a-entity",{camera:!0})]})}}]),n}(l.a.Component)),Q=(n(125),g.a.initializeApp({apiKey:"AIzaSyAA4zXM0wRBrL1l65NHg_8mQcjg75ew9RQ",authDomain:"campus-coloring.firebaseapp.com",databaseURL:"https://campus-coloring.firebaseio.com",projectId:"campus-coloring",storageBucket:"campus-coloring.appspot.com",messagingSenderId:"45926036058",appId:"1:45926036058:web:a9271137ac86762843de63",measurementId:"G-WPPW3TX4QG"})),H=Q.auth(),J=Q.database(),X=Q.storage(),K=function(e){Object(s.a)(n,e);var t=Object(o.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={imagesInfo:null,currentLocation:null,user:"loading",displayImageIndex:0},e.setImagesInfo=function(t){return e.setState({imagesInfo:t})},e.setLocation=function(t){return e.setState({currentLocation:t})},e.setDisplayImageIndex=function(t){return e.setState({displayImageIndex:t})},e}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this;H.onAuthStateChanged((function(t){t?e.setState({user:t}):e.setState({user:null})}))}},{key:"render",value:function(){return Object(a.jsxs)("div",{style:{width:"100%",height:"100%"},children:[Object(a.jsx)(G,{db:J,storage:X,setImagesInfo:this.setImagesInfo,setLocation:this.setLocation,displayImageIndex:this.state.displayImageIndex}),Object(a.jsx)(E,{imagesInfo:this.state.imagesInfo,currentLocation:this.state.currentLocation,auth:H,user:this.state.user,db:J,storage:X,setDisplayImageIndex:this.setDisplayImageIndex})]})}}]),n}(l.a.Component);d.a.render(Object(a.jsx)(K,{}),document.getElementById("root"))}},[[127,1,2]]]);
//# sourceMappingURL=main.90471fb8.chunk.js.map